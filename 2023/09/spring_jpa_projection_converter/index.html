<!DOCTYPE html>
<html><head>
<title>Spring JPA Projection with Converter</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="紀錄使用 Spring JPA projection 時遇到的一些 type 轉換問題">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<script async src="https://www.googletagmanager.com/gtag/js?id=G-JP1V61PPMJ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-JP1V61PPMJ', { 'anonymize_ip': false });
}
</script>







  






      <script src="https://blog.idontwannarock.me/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="https://blog.idontwannarock.me/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="https://blog.idontwannarock.me/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">












<script src="https://cdn.jsdelivr.net/npm/vue-disqus@3/dist/vue-disqus.js"></script>








</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://blog.idontwannarock.me/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://blog.idontwannarock.me/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://blog.idontwannarock.me/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://blog.idontwannarock.me/about">
                    About
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://blog.idontwannarock.me/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pre-requisite" class="nav-pre-requisite">
									Pre-requisite
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%83%85%e5%a2%83%e6%8f%8f%e8%bf%b0" class="nav-情境描述">
									情境描述
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%ad%e5%ae%9a-converter" class="nav-設定-converter">
									設定 Converter
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%ba%8c%e7%a8%ae%e6%83%85%e5%a2%83%e6%8f%8f%e8%bf%b0" class="nav-第二種情境描述">
									第二種情境描述
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#spring-boot-240-%e4%bb%a5%e5%89%8d" class="nav-spring-boot-240-以前">
									Spring Boot 2.4.0 以前
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#spring-boot-240-%e4%bb%a5%e5%be%8c" class="nav-spring-boot-240-以後">
									Spring Boot 2.4.0 以後
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#reference" class="nav-reference">
									Reference
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://blog.idontwannarock.me/">
            Howard Tech Note
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://blog.idontwannarock.me/">
        <div class="single-column-header-title">Howard Tech Note</div>
        
        <div class="single-column-header-subtitle">Share * Record * Program</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Spring JPA Projection with Converter
                    
                    <div class="post-subtitle">
                        紀錄使用 Spring JPA projection 時遇到的一些 type 轉換問題
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2023-09-20 09:37
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="https://blog.idontwannarock.me/categories/implementation">implementation</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="https://blog.idontwannarock.me/tags/java">java</a>
                                &nbsp;
                            
                                <a href="https://blog.idontwannarock.me/tags/spring-jpa">spring-jpa</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="pre-requisite">Pre-requisite</h1>
<ul>
<li>JDK 11+</li>
<li>Spring Boot 2+</li>
</ul>
<h1 id="情境描述">情境描述</h1>
<p>使用 JPA 做單表查詢非常方便，但有時候因為效能考量，會出現 DB data type 與 Java data type 無法直接對應或需要做一些客製化調整</p>
<p>例如在保存狀態時，因為狀態通常有固定且少量的值，所以會考慮採用 <code>int</code> 而非 <code>varchar</code> 來保存，在存儲大小跟查詢效能上都較優</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> CHATROOM
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">`</span>STATUS<span style="color:#ff79c6">`</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>但在程式面都採用 Java 的 <code>int</code> 來操作狀態，可讀性相對較低，所以可能會考慮採用 <code>enum</code> 來操作，可讀性較佳且有 type check</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">enum</span> ChatroomStatus <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    CLOSED<span style="color:#ff79c6">,</span> ACTIVE
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h1 id="設定-converter">設定 Converter</h1>
<p>但 JPA 預設並不能將 Java <code>enum</code> 與 MySQL <code>int</code> 做 mapping，所以會需要提供 converter 讓 JPA 知道怎麼做轉換</p>
<p>首先需要調整 <code>enum</code> 如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">enum</span> ChatroomStatus <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    CLOSED<span style="color:#ff79c6">(</span><span style="color:#bd93f9">0</span><span style="color:#ff79c6">),</span>
</span></span><span style="display:flex;"><span>    ACTIVE<span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> value<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    ChatroomStatus<span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> value<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span> <span style="color:#ff79c6">=</span> value<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> ChatroomStatus <span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> value<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span>ChatroomStatus target <span style="color:#ff79c6">:</span> ChatroomStatus<span style="color:#ff79c6">.</span><span style="color:#50fa7b">values</span><span style="color:#ff79c6">())</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>target<span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span> <span style="color:#ff79c6">==</span> value<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> target<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>接著要提供 converter</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> jakarta.persistence.AttributeConverter<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> jakarta.persistence.Converter<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Converter<span style="color:#ff79c6">(</span>autoApply <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ChatroomStatusConverter</span> <span style="color:#8be9fd;font-style:italic">implements</span> AttributeConverter<span style="color:#ff79c6">&lt;</span>ChatroomStatus<span style="color:#ff79c6">,</span> Integer<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> Integer <span style="color:#50fa7b">convertToDatabaseColumn</span><span style="color:#ff79c6">(</span>ChatroomStatus attribute<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>attribute <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> attribute<span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> ChatroomStatus <span style="color:#50fa7b">convertToEntityAttribute</span><span style="color:#ff79c6">(</span>Integer dbData<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>dbData <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> ChatroomStatus<span style="color:#ff79c6">.</span><span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span>dbData<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>最後提供 entity</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span>@Table<span style="color:#ff79c6">(</span>name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;CHATROOM&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ChatroomDo</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    @NotNull
</span></span><span style="display:flex;"><span>	@Column<span style="color:#ff79c6">(</span>name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;STATUS&#34;</span><span style="color:#ff79c6">,</span> nullable <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> ChatroomStatus status<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>就可以正常使用 repository 做 CRUD 操作，而同時在 DB 當中 STATUS 為 <code>0</code> 代表 chatroom closed、<code>1</code> 代表 chatroom active</p>
<h1 id="第二種情境描述">第二種情境描述</h1>
<p>有時候我們會需要做一些複雜查詢，尤其是使用到其他 table 做 join 查詢，而且 select 的欄位不一定只選擇一個 entity 包含的欄位，此時就會需要利用 JPA 的 projection 功能</p>
<blockquote>
<p>有些情況可以用關聯來處理，但以下假設並沒有在 JPA 設定關聯，而是直接用 native SQL join 的方式做查詢</p>
</blockquote>
<p>例如以下 table</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> MESSAGE
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">TYPE</span> <span style="color:#8be9fd;font-style:italic">INT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>  REPLIED_MESSAGE_ID <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>對應的 <code>MessageDo</code> entity 如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span>@Table<span style="color:#ff79c6">(</span>name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;MESSAGE&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MessageDo</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    @Column<span style="color:#ff79c6">(</span>name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;TYPE&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> MessageType type<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    @Column<span style="color:#ff79c6">(</span>name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;REPLIED_MESSAGE_ID&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Long repliedMessageId<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>其中 <code>MessageType</code> 如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">enum</span> MessageType <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    TEXT<span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span><span style="color:#ff79c6">),</span>
</span></span><span style="display:flex;"><span>    IMAGE<span style="color:#ff79c6">(</span><span style="color:#bd93f9">2</span><span style="color:#ff79c6">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">int</span> value<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    MessageType<span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> value<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span> <span style="color:#ff79c6">=</span> value<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> MessageType <span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> value<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span>MessageType target <span style="color:#ff79c6">:</span> MessageType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">values</span><span style="color:#ff79c6">())</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>target<span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">==</span> value<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">return</span> target<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>按照慣例，提供 converter 如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> jakarta.persistence.AttributeConverter<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> jakarta.persistence.Converter<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Converter<span style="color:#ff79c6">(</span>autoApply <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MessageTypeConverter</span> <span style="color:#8be9fd;font-style:italic">implements</span> AttributeConverter<span style="color:#ff79c6">&lt;</span>MessageType<span style="color:#ff79c6">,</span> Integer<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> Integer <span style="color:#50fa7b">convertToDatabaseColumn</span><span style="color:#ff79c6">(</span>MessageType attribute<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>attribute <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> attribute<span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> MessageType <span style="color:#50fa7b">convertToEntityAttribute</span><span style="color:#ff79c6">(</span>Integer dbData<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>dbData <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> MessageType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span>dbData<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>此時若需要取得一個 message 以及其回覆 message 的內容，則 JPA query method 就無法 return MessageDo，所以此時我們採用 JPA interface-based projection 來達成此操作，首先按照官方 doc 提供 interface 如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">MessageViewDo</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    MessageType <span style="color:#50fa7b">getType</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    Long <span style="color:#50fa7b">getRepliedMessageId</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    MessageType <span style="color:#50fa7b">getRepliedMessageType</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>然後是 query 如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">MessageDao</span> <span style="color:#8be9fd;font-style:italic">extends</span> JpaRepository<span style="color:#ff79c6">&lt;</span>MessageDo<span style="color:#ff79c6">,</span> Long<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Query<span style="color:#ff79c6">(</span>value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;SELECT &#34;</span> <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;  m.TYPE, &#34;</span> <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;  rm.ID AS repliedMessageId, &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;  rm.TYPE AS repliedMessageType, &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;FROM MESSAGE m &#34;</span> <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;LEFT JOIN MESSAGE rm ON m.REPLIED_MESSAGE_ID = rm.ID &#34;</span> <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;WHERE m.ID = :id&#34;</span><span style="color:#ff79c6">,</span> nativeQuery <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&lt;</span>MessageViewDo<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">findMessageViewById</span><span style="color:#ff79c6">(</span>Long id<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>此時當我們使用的時候，會開心地發現取出來的 <code>MessageType</code> 值有問題，要不是取出來的值不對，就是會報 <code>org.springframework.core.convert.ConversionFailedException</code> 的錯誤，仔細看 cause 還是 <code>Caused by: java.lang.ArrayIndexOutOfBoundsException</code>？</p>
<p>這是因為 JPA 的 interface-based projection 實際上是用 proxy 來包住取得的 result，等到使用者要使用到物件的時候才做轉換，而且因為我們做的是 open projection (projection 的結果並非基於 entity class)，所以 JPA 無法像 closed projection (projection 結果基於 entity) 那樣從原始的 entity 身上取得 metadata 做轉換，所以只能用 Spring 預設的 converter 來做轉換</p>
<p>是的，因為無法取得 entity 的 metadata，所以此時使用的不是 JPA 的 converter 而是 Spring Core 自帶的 converter，而我們並沒有將我們自定義的 Spring converter 註冊給 Spring DI container，所以它只會用預設的方式去做 <code>int</code> -&gt; <code>enum</code> 的轉換</p>
<p>而 Spring 預設對 <code>int</code> -&gt; <code>enum</code> 的轉換是依照 <code>enum</code> 的 ordinal (順序) 做轉換，而且 ordinal 是從 0 開始，所以你可能會很容易看到轉換出來的 <code>MessageType</code> 比 DB 中的剛好大一號，例如 DB 中的 <code>TYPE</code> 是 <code>1</code> 應該代表的是 <code>TEXT</code>，但取出來卻變成 <code>IMAGE</code> 這樣的情況；更甚者，如果 DB 的值剛好大於等於 <code>enum</code> 的 size 就會報 <code>org.springframework.core.convert.ConversionFailedException</code></p>
<p>因此，很自然的我們就應該要提供 converter 給 Spring</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.core.convert.converter.Converter<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.lang.NonNull<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> java.util.Arrays<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MessageTypeConverter</span> <span style="color:#8be9fd;font-style:italic">implements</span> Converter<span style="color:#ff79c6">&lt;</span>Integer<span style="color:#ff79c6">,</span> MessageType<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> MessageType <span style="color:#50fa7b">convert</span><span style="color:#ff79c6">(</span>@NonNull Integer source<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>Arrays<span style="color:#ff79c6">.</span><span style="color:#50fa7b">stream</span><span style="color:#ff79c6">(</span>MessageType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">values</span><span style="color:#ff79c6">()).</span><span style="color:#50fa7b">anyMatch</span><span style="color:#ff79c6">(</span>target <span style="color:#ff79c6">-&gt;</span> target<span style="color:#ff79c6">.</span><span style="color:#50fa7b">value</span> <span style="color:#ff79c6">==</span> source<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> MessageType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">of</span><span style="color:#ff79c6">(</span>source<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>但這時候問題就來了，要怎麼註冊這個 converter？這個時候就要看 Spring Boot 的版本了</p>
<h2 id="spring-boot-240-以前">Spring Boot 2.4.0 以前</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.boot.context.event.ApplicationReadyEvent<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.context.annotation.Configuration<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.context.event.EventListener<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.core.convert.support.DefaultConversionService<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ConverterConfig</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @EventListener<span style="color:#ff79c6">(</span>ApplicationReadyEvent<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">config</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        DefaultConversionService conversionService <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>DefaultConversionService<span style="color:#ff79c6">)</span> DefaultConversionService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getSharedInstance</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        conversionService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">addConverter</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> MessageTypeConverter<span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h2 id="spring-boot-240-以後">Spring Boot 2.4.0 以後</h2>
<p>因為 Spring Boot 2.4.0 以後沒辦法用 <code>DefaultConversionService.getSharedInstance()</code> 的方式，所以最後參考了 <a href="https://stackoverflow.com/a/65355897">這裡</a> 提供的方式，用反射來註冊 converter</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.boot.context.event.ApplicationReadyEvent<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.context.annotation.Configuration<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.context.event.EventListener<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> org.springframework.core.convert.support.GenericConversionService<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> java.lang.reflect.Field<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">JpaProjectionConverterConfig</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@EventListener<span style="color:#ff79c6">(</span>ApplicationReadyEvent<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">offsetDateTimeConversion</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> ClassNotFoundException<span style="color:#ff79c6">,</span> NoSuchFieldException<span style="color:#ff79c6">,</span> IllegalAccessException <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		Class<span style="color:#ff79c6">&lt;?&gt;</span> aClass <span style="color:#ff79c6">=</span> Class<span style="color:#ff79c6">.</span><span style="color:#50fa7b">forName</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;org.springframework.data.projection.ProxyProjectionFactory&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>		Field field <span style="color:#ff79c6">=</span> aClass<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getDeclaredField</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;CONVERSION_SERVICE&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>		field<span style="color:#ff79c6">.</span><span style="color:#50fa7b">setAccessible</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>		GenericConversionService service <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>GenericConversionService<span style="color:#ff79c6">)</span> field<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">null</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		service<span style="color:#ff79c6">.</span><span style="color:#50fa7b">addConverter</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> MessageTypeConverter<span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>如此就可以利用框架自動 mapping Java <code>enum</code> 與 MySQL <code>int</code></p>
<p>另外提一下，Java 的 <code>Instant</code> 或 <code>OffsetDateTime</code> 與 MySQL <code>datetime</code> 之間也有類似的問題，所以也需要提供一個 converter 做 <code>Instant</code> 或 <code>OffsetDateTime</code> 與 <code>java.sql.Timestamp</code> 之間做轉換</p>
<blockquote>
<p>JPA 會把 MySQL 的 <code>datetime</code> 以 <code>java.sql.Timestamp</code> 取出來</p>
</blockquote>
<h1 id="reference">Reference</h1>
<ul>
<li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#projections">Spring Data JPA - Reference Documentation</a></li>
<li><a href="https://stackoverflow.com/a/65355897">Spring JPA - &ldquo;java.lang.IllegalArgumentException: Projection type must be an interface!&rdquo; (using native query)</a></li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2023-09-20</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://blog.idontwannarock.me/2023/10/mysql_8_utc_timestamp_as_datetime_default_bug/">
			Next<br>MySQL 8.0 使用 UTC_TIMESTAMP() 當作 DATETIME 欄位預設值 bug
                </a>
                
                
                
                <a class="older-posts" href="https://blog.idontwannarock.me/2023/06/scoop/">
			Previous<br>Scoop 介紹及用法
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                
<div id="disqus_thread"></div>
<script>
    

    var disqus_config = function () {
        
        this.page.url = 'https:\/\/blog.idontwannarock.me\/2023\/09\/spring_jpa_projection_converter\/';  
        
        
        this.page.identifier = '\/2023\/09\/spring_jpa_projection_converter\/'; 
    };
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://howard-tech-blog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow"> comments powered by Disqus.  </a> </noscript>













            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://blog.idontwannarock.me/">
    
        <div class="nav-title">
            Howard Tech Note
        </div>
        
        <div class="nav-subtitle">
            Share * Record * Program
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://blog.idontwannarock.me/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://blog.idontwannarock.me/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://blog.idontwannarock.me/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://blog.idontwannarock.me/about">
                About
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://blog.idontwannarock.me/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This website by Howard Wang is licensed under a Creative Common Attribution-ShareAlike 4.0 International License.
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#pre-requisite" class="nav-pre-requisite">
									Pre-requisite
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%83%85%e5%a2%83%e6%8f%8f%e8%bf%b0" class="nav-情境描述">
									情境描述
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%ad%e5%ae%9a-converter" class="nav-設定-converter">
									設定 Converter
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%ba%8c%e7%a8%ae%e6%83%85%e5%a2%83%e6%8f%8f%e8%bf%b0" class="nav-第二種情境描述">
									第二種情境描述
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#spring-boot-240-%e4%bb%a5%e5%89%8d" class="nav-spring-boot-240-以前">
									Spring Boot 2.4.0 以前
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#spring-boot-240-%e4%bb%a5%e5%be%8c" class="nav-spring-boot-240-以後">
									Spring Boot 2.4.0 以後
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#reference" class="nav-reference">
									Reference
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This website by Howard Wang is licensed under a Creative Common Attribution-ShareAlike 4.0 International License.
	
</div>
            </div>
    
    <script src="https://blog.idontwannarock.me/js/journal.js"></script></body>
</html>
